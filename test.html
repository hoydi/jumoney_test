<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Color Overlay</title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="43" height="45"></canvas>
    <!-- <img id="image1" src="./pouch/silk/실크-베이스.png" style="display:none;">
    <img id="image2" src="./pouch/silk/실크-안감.png" style="display:none;">
    <img id="image3" src="./pouch/silk/실크-겉감.png" style="display:none;">
    <img id="image4" src="./pouch/silk/실크-라이트.png" style="display:none;"> -->

    <!-- <img id="image1" src="./pouch/fabric/최고급-베이스.png" style="display:none;">
    <img id="image2" src="./pouch/fabric/최고급-안감.png" style="display:none;">
    <img id="image3" src="./pouch/fabric/최고급-겉감.png" style="display:none;">
    <img id="image4" src="./pouch/fabric/최고급-라이트.png" style="display:none;"> -->

    <img id="image1" src="./pouch/leather/가죽-베이스.png" style="display:none;">
    <img id="image2" src="./pouch/leather/가죽-안감.png" style="display:none;">
    <img id="image3" src="./pouch/leather/가죽-겉감.png" style="display:none;">
    <img id="image4" src="./pouch/leather/가죽-라이트.png" style="display:none;">

    <script>
        
        // 'rgb(206, 179, 165)' 형식의 문자열에서 숫자 추출
        function rgbStringToObject(colorRgb) {
            const rgbValues = colorRgb.match(/\d+/g);
            return {
                r: parseInt(rgbValues[0], 10),
                g: parseInt(rgbValues[1], 10),
                b: parseInt(rgbValues[2], 10)
            };
        }


        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const image1 = document.getElementById('image1');
        const image2 = document.getElementById('image2');
        const image3 = document.getElementById('image3');
        const image4 = document.getElementById('image4');

        // 이미지 로딩 완료 시 호출되는 함수
        let imagesLoaded = 0;
        const totalImages = 4;

        function imageLoaded() {
            imagesLoaded++;
            if (imagesLoaded === totalImages) {
                canvas.width = image1.width;
        canvas.height = image1.height;
                drawImages();
            }
        }

        // 이미지가 로드되면 호출
        image1.onload = imageLoaded;
        image2.onload = imageLoaded;
        image3.onload = imageLoaded;
        image4.onload = imageLoaded;

        function applyColorToWhitePixels(image, color) {
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = image.width;
            tempCanvas.height = image.height;

            // 이미지 그리기
            tempCtx.drawImage(image, 0, 0, canvas.width, canvas.height);

            // 픽셀 데이터를 가져옴
            const imageData = tempCtx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            // 투명도를 제외한 흰색 픽셀에 색 입히기
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                const alpha = data[i + 3];

                // 완전한 흰색인 경우 (RGB가 255이고 투명도가 있는 픽셀)
                if (r === 255 && g === 255 && b === 255 && alpha > 0) {
                    data[i] = color.r;      // R
                    data[i + 1] = color.g;  // G
                    data[i + 2] = color.b;  // B
                }
            }

            // 색상이 입혀진 데이터를 다시 캔버스에 적용
            tempCtx.putImageData(imageData, 0, 0);
            return tempCanvas;
        }

        // 이미지를 그리는 함수
        function drawImages() {

            ctx.globalCompositeOperation = 'multiply';
            ctx.drawImage(image1, 0, 0, canvas.width, canvas.height);
            //ctx.globalCompositeOperation = 'overlay'
            ctx.drawImage(image1, 0, 0, canvas.width, canvas.height);

            ctx.filter = 'saturate(120%)';
            //const blueOverlay = applyColorToWhitePixels(image3, { r: 212, g: 132, b: 137 });
            //const blueOverlay = applyColorToWhitePixels(image3, { r: 115, g: 0, b: 0 });
            //const blueOverlay = applyColorToWhitePixels(image3, { r: 255, g: 255, b: 255 });
            const blueOverlay = applyColorToWhitePixels(image3, { r: 140, g: 125, b: 176 });
            //const blueOverlay = applyColorToWhitePixels(image3, { r: 0, g: 0, b: 0 });
           
            ctx.drawImage(blueOverlay, 0, 0, canvas.width, canvas.height);
            
            //ctx.filter = 'none';
            //const redOverlay = applyColorToWhitePixels(image2, { r: 141, g: 117, b: 180 });
            //const redOverlay = applyColorToWhitePixels(image2, { r: 0, g: 0, b: 0 });
            //const redOverlay = applyColorToWhitePixels(image2, { r: 194, g: 178, b: 231 });
            const redOverlay = applyColorToWhitePixels(image2, { r: 255, g: 255, b: 255 });
            //const redOverlay = applyColorToWhitePixels(image2, { r: 194, g: 178, b: 231 });
                        
            ctx.drawImage(redOverlay, 0, 0, canvas.width, canvas.height);


            ctx.globalCompositeOperation = 'lighter';
            ctx.filter = 'brightness(100%)';
            ctx.drawImage(image4, 0, 0, canvas.width, canvas.height);
            // 블렌딩 모드를 기본값으로 되돌림
            ctx.globalCompositeOperation = 'source-over';
            ctx.globalAlpha = 1.0;
        }

    </script>
</body>
</html>
